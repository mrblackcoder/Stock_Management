# 🏗️ System Architecture - Stock Management System

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              CLIENT LAYER                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    ┌──────────────────────┐         ┌──────────────────────┐                │
│    │   React Frontend     │         │   Thymeleaf Pages    │                │
│    │   (Port 3000/80)     │         │   (Server-Side)      │                │
│    │                      │         │                      │                │
│    │  - Dashboard         │         │  - Login Page        │                │
│    │  - Products          │         │  - Register Page     │                │
│    │  - Categories        │         │  - Dashboard         │                │
│    │  - Suppliers         │         │                      │                │
│    │  - Transactions      │         │                      │                │
│    │  - Profile           │         │                      │                │
│    └──────────┬───────────┘         └──────────┬───────────┘                │
│               │                                │                            │
│               │    REST API (JSON)             │    HTTP (HTML)              │
│               └───────────────┬────────────────┘                            │
│                               │                                              │
└───────────────────────────────┼──────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          API GATEWAY / PROXY                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    ┌──────────────────────────────────────────────────────────────────┐     │
│    │                      NGINX (Port 80)                             │     │
│    │                                                                   │     │
│    │   - Reverse Proxy: /api/* → localhost:8080                       │     │
│    │   - Static Files: /* → /var/www/stockmanagement                  │     │
│    │   - SSL Termination (HTTPS)                                      │     │
│    │   - Load Balancing (optional)                                    │     │
│    └──────────────────────────────────────────────────────────────────┘     │
│                                                                              │
└───────────────────────────────┬──────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    ┌──────────────────────────────────────────────────────────────────┐     │
│    │              Spring Boot Application (Port 8080)                  │     │
│    ├──────────────────────────────────────────────────────────────────┤     │
│    │                                                                   │     │
│    │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │     │
│    │  │ Controllers │  │  Services   │  │    Security Layer       │  │     │
│    │  │             │  │             │  │                         │  │     │
│    │  │ - Auth      │  │ - AuthSvc   │  │ - JWT Filter            │  │     │
│    │  │ - Product   │  │ - ProductSvc│  │ - Security Config       │  │     │
│    │  │ - Category  │  │ - CategorySvc│ │ - Brute Force Guard     │  │     │
│    │  │ - Supplier  │  │ - SupplierSvc│ │ - Password Validator    │  │     │
│    │  │ - Trans.    │  │ - TransSvc  │  │ - CORS Config           │  │     │
│    │  │ - User      │  │ - UserSvc   │  │                         │  │     │
│    │  └─────────────┘  └─────────────┘  └─────────────────────────┘  │     │
│    │                                                                   │     │
│    │  ┌─────────────────────────────────────────────────────────────┐ │     │
│    │  │                    Repository Layer (JPA)                    │ │     │
│    │  │                                                              │ │     │
│    │  │  UserRepo | ProductRepo | CategoryRepo | SupplierRepo | etc  │ │     │
│    │  └─────────────────────────────────────────────────────────────┘ │     │
│    │                                                                   │     │
│    └──────────────────────────────────────────────────────────────────┘     │
│                                                                              │
└───────────────────────────────┬──────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DATA LAYER                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    ┌──────────────────────────────────────────────────────────────────┐     │
│    │                   MySQL 8.0 Database                              │     │
│    │              (AWS RDS / Local Docker)                             │     │
│    │                                                                   │     │
│    │   ┌─────────┐ ┌─────────┐ ┌───────────┐ ┌──────────────────┐    │     │
│    │   │  USERS  │ │PRODUCTS │ │CATEGORIES │ │STOCK_TRANSACTIONS│    │     │
│    │   └─────────┘ └─────────┘ └───────────┘ └──────────────────┘    │     │
│    │                                                                   │     │
│    │   ┌───────────┐ ┌────────────────┐                               │     │
│    │   │ SUPPLIERS │ │ REFRESH_TOKENS │                               │     │
│    │   └───────────┘ └────────────────┘                               │     │
│    │                                                                   │     │
│    └──────────────────────────────────────────────────────────────────┘     │
│                                                                              │
└───────────────────────────────┬──────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        EXTERNAL SERVICES                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    ┌──────────────────────┐         ┌──────────────────────┐                │
│    │  ExchangeRate-API    │         │  Spring Actuator     │                │
│    │  (Currency Rates)    │         │  (Health/Metrics)    │                │
│    │                      │         │                      │                │
│    │  TRY → USD           │         │  /actuator/health    │                │
│    │  TRY → EUR           │         │  /actuator/metrics   │                │
│    │                      │         │  /actuator/prometheus│                │
│    └──────────────────────┘         └──────────────────────┘                │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

## Component Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        SPRING BOOT APPLICATION                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      PRESENTATION LAYER                              │    │
│  │                                                                      │    │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌────────────┐ │    │
│  │  │AuthController│ │ProductCtrl   │ │CategoryCtrl  │ │SupplierCtrl│ │    │
│  │  │              │ │              │ │              │ │            │ │    │
│  │  │POST /login   │ │GET /products │ │GET /categories│ │GET /suppliers│    │
│  │  │POST /register│ │POST /products│ │POST /categories│POST /suppliers│    │
│  │  │POST /refresh │ │PUT /products │ │PUT /categories │ │PUT /suppliers│   │
│  │  │POST /logout  │ │DELETE /prods │ │DELETE /cats  │ │DELETE /sups│ │    │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └────────────┘ │    │
│  │                                                                      │    │
│  │  ┌──────────────┐ ┌──────────────┐                                  │    │
│  │  │TransactionCtrl│ │ UserCtrl    │                                  │    │
│  │  │              │ │              │                                  │    │
│  │  │POST /purchase│ │GET /profile  │                                  │    │
│  │  │POST /sale    │ │PUT /profile  │                                  │    │
│  │  │POST /adjust  │ │GET /all(admin)│                                 │    │
│  │  └──────────────┘ └──────────────┘                                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                      │                                       │
│                                      ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                        SERVICE LAYER                                 │    │
│  │                                                                      │    │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌────────────┐ │    │
│  │  │ AuthService  │ │ProductService│ │CategoryService│ │SupplierSvc│ │    │
│  │  │              │ │              │ │              │ │            │ │    │
│  │  │- authenticate│ │- CRUD ops    │ │- CRUD ops    │ │- CRUD ops  │ │    │
│  │  │- validatePwd │ │- search      │ │              │ │            │ │    │
│  │  │- generateJWT │ │- lowStock    │ │              │ │            │ │    │
│  │  │- refreshToken│ │- pagination  │ │              │ │            │ │    │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └────────────┘ │    │
│  │                                                                      │    │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────────────────────┐ │    │
│  │  │TransactionSvc│ │ UserService  │ │   JwtService                │ │    │
│  │  │              │ │              │ │                              │ │    │
│  │  │- purchase    │ │- getProfile  │ │- generateToken               │ │    │
│  │  │- sale        │ │- updateProfile│ │- validateToken              │ │    │
│  │  │- adjustment  │ │- getAllUsers │ │- extractUsername             │ │    │
│  │  │- updateStock │ │              │ │- extractRole                 │ │    │
│  │  └──────────────┘ └──────────────┘ └──────────────────────────────┘ │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                      │                                       │
│                                      ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      REPOSITORY LAYER (JPA)                          │    │
│  │                                                                      │    │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────────┐   │    │
│  │  │UserRepo    │ │ProductRepo │ │CategoryRepo│ │SupplierRepo    │   │    │
│  │  └────────────┘ └────────────┘ └────────────┘ └────────────────┘   │    │
│  │                                                                      │    │
│  │  ┌────────────┐ ┌────────────────────┐                              │    │
│  │  │TransRepo   │ │RefreshTokenRepo    │                              │    │
│  │  └────────────┘ └────────────────────┘                              │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

## Security Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AUTHENTICATION FLOW                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. LOGIN REQUEST                                                            │
│  ┌─────────┐    POST /api/auth/login     ┌──────────────┐                   │
│  │ Client  │ ────────────────────────────▶ AuthController│                   │
│  └─────────┘    {username, password}     └──────┬───────┘                   │
│                                                  │                           │
│  2. AUTHENTICATION                              ▼                            │
│                                          ┌──────────────┐                    │
│                                          │ AuthService  │                    │
│                                          │              │                    │
│                                          │ - Check brute│                    │
│                                          │   force      │                    │
│                                          │ - Validate   │                    │
│                                          │   password   │                    │
│                                          │ - Load user  │                    │
│                                          └──────┬───────┘                    │
│                                                  │                           │
│  3. TOKEN GENERATION                            ▼                            │
│                                          ┌──────────────┐                    │
│                                          │  JwtService  │                    │
│                                          │              │                    │
│                                          │ - Generate   │                    │
│                                          │   access JWT │                    │
│                                          │ - Generate   │                    │
│                                          │   refresh tok│                    │
│                                          └──────┬───────┘                    │
│                                                  │                           │
│  4. RESPONSE                                    ▼                            │
│  ┌─────────┐    {token, refreshToken,    ┌──────────────┐                   │
│  │ Client  │ ◀──────────────────────────── AuthController│                   │
│  └─────────┘     role, username}         └──────────────┘                   │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                        PROTECTED RESOURCE ACCESS                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. API REQUEST WITH JWT                                                     │
│  ┌─────────┐    GET /api/products        ┌──────────────┐                   │
│  │ Client  │ ────────────────────────────▶ JwtAuthFilter │                   │
│  └─────────┘    Authorization: Bearer xxx└──────┬───────┘                   │
│                                                  │                           │
│  2. TOKEN VALIDATION                            ▼                            │
│                                          ┌──────────────┐                    │
│                                          │  JwtService  │                    │
│                                          │              │                    │
│                                          │ - Extract    │                    │
│                                          │   claims     │                    │
│                                          │ - Validate   │                    │
│                                          │   signature  │                    │
│                                          │ - Check      │                    │
│                                          │   expiration │                    │
│                                          └──────┬───────┘                    │
│                                                  │                           │
│  3. AUTHORIZATION                               ▼                            │
│                                          ┌──────────────┐                    │
│                                          │SecurityConfig│                    │
│                                          │              │                    │
│                                          │ - Check role │                    │
│                                          │ - @PreAuth   │                    │
│                                          │   validate   │                    │
│                                          └──────┬───────┘                    │
│                                                  │                           │
│  4. CONTROLLER ACCESS                           ▼                            │
│                                          ┌──────────────┐                    │
│                                          │ProductCtrl   │ ──▶ Service ──▶ DB │
│                                          └──────────────┘                    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

## Deployment Architecture (AWS)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              AWS CLOUD                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         VPC (eu-north-1)                              │  │
│  │                                                                        │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐ │  │
│  │  │                      PUBLIC SUBNET                                │ │  │
│  │  │                                                                   │ │  │
│  │  │    ┌─────────────────────────────────────────────────────────┐   │ │  │
│  │  │    │                    EC2 Instance                         │   │ │  │
│  │  │    │                    (t3.micro)                           │   │ │  │
│  │  │    │                                                         │   │ │  │
│  │  │    │    ┌─────────────┐    ┌─────────────────────────────┐  │   │ │  │
│  │  │    │    │   Nginx     │    │    Spring Boot App          │  │   │ │  │
│  │  │    │    │  (Port 80)  │    │    (Port 8080)              │  │   │ │  │
│  │  │    │    │             │    │                             │  │   │ │  │
│  │  │    │    │ Reverse     │───▶│  Java 21                    │  │   │ │  │
│  │  │    │    │ Proxy       │    │  stock-management.jar       │  │   │ │  │
│  │  │    │    └─────────────┘    └─────────────────────────────┘  │   │ │  │
│  │  │    │                                                         │   │ │  │
│  │  │    │    ┌─────────────────────────────────────────────────┐  │   │ │  │
│  │  │    │    │           React Build (Static Files)            │  │   │ │  │
│  │  │    │    │           /var/www/stockmanagement               │  │   │ │  │
│  │  │    │    └─────────────────────────────────────────────────┘  │   │ │  │
│  │  │    │                                                         │   │ │  │
│  │  │    └─────────────────────────────────────────────────────────┘   │ │  │
│  │  │                                                                   │ │  │
│  │  │    Elastic IP: 51.21.249.94                                      │ │  │
│  │  │    Security Group: Ports 22, 80, 443                             │ │  │
│  │  │                                                                   │ │  │
│  │  └──────────────────────────────────────────────────────────────────┘ │  │
│  │                                      │                                 │  │
│  │                                      │ Port 3306                       │  │
│  │                                      ▼                                 │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐ │  │
│  │  │                      PRIVATE SUBNET                               │ │  │
│  │  │                                                                   │ │  │
│  │  │    ┌─────────────────────────────────────────────────────────┐   │ │  │
│  │  │    │                    RDS MySQL 8.0                        │   │ │  │
│  │  │    │                    (db.t3.micro)                        │   │ │  │
│  │  │    │                                                         │   │ │  │
│  │  │    │    Endpoint: stock-management-db.xxx.eu-north-1.rds     │   │ │  │
│  │  │    │    Database: inventory_management_db                    │   │ │  │
│  │  │    │    User: admin                                          │   │ │  │
│  │  │    │                                                         │   │ │  │
│  │  │    │    - Multi-AZ: No (Free Tier)                          │   │ │  │
│  │  │    │    - Storage: 20GB gp2                                  │   │ │  │
│  │  │    │    - Automated Backups: 7 days                          │   │ │  │
│  │  │    └─────────────────────────────────────────────────────────┘   │ │  │
│  │  │                                                                   │ │  │
│  │  └──────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                        │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

## Technology Stack

| Layer | Technology | Version | Purpose |
|-------|------------|---------|---------|
| Frontend | React | 19.2.0 | SPA UI |
| Frontend | Bootstrap | 5.x | CSS Framework |
| Frontend | Chart.js | 4.x | Data Visualization |
| Frontend | Axios | 1.x | HTTP Client |
| Backend | Spring Boot | 3.5.7 | Application Framework |
| Backend | Spring Security | 6.x | Authentication/Authorization |
| Backend | Spring Data JPA | 3.x | ORM |
| Backend | JJWT | 0.12.3 | JWT Tokens |
| Backend | SpringDoc | 2.3.0 | OpenAPI/Swagger |
| Database | MySQL | 8.0 | Relational Database |
| Server | Nginx | 1.x | Reverse Proxy |
| Runtime | Java | 21 (LTS) | JVM |
| Build | Gradle | 8.x | Build Tool |
| Deploy | Docker | 24.x | Containerization |
| Cloud | AWS EC2 | t3.micro | Compute |
| Cloud | AWS RDS | MySQL 8.0 | Managed Database |

---

*Last Updated: December 2024*
